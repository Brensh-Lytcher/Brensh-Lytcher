日付 : 2024/07/16~18
Plan
  1. 回帰モデルと分類モデルのスコアの違いの調査
  2. 作成した組み合わせ特徴量の有効性の確認
  3. 特徴量選択とパラメータ最適化を使った予測

Do
  1. 回帰モデルと分類モデルのスコアの違いの調査
      コンペが与えた基本的な特徴量だけを使って(つまり自作特徴量を使わない)、パラメータを調整せずに予測した結果、CatBoostClassifierのスコアが0.75154であったのに対して、CatBoostRegressorのスコアが0.88697もあった。前者が上位80%から90%の間にあるが、後者が上位50%から60%の間にある。よって、このコンペにおいて、回帰モデルが分類モデルよりはるかに良いことがわかる。しかし、このコンペは口座を解除するかどうかを予測する、つまり2クラス分類であるべきなのに、なぜ回帰分析の結果である0から1の間の連続値が予測結果として使える、しかもスコアが分類モデルよりはるかに高いのか、という疑問を抱えた。そのため、私はコンペのスコア計算方法(ROC曲線の下の面積)について調べた。
      ROC曲線は、予測対象の予測確率を閾値に基づいて真偽に分類するとき、縦軸をTPR（真陽性率）、横軸をFPR（偽陽性率）として、予測確率の分類閾値を変化しながらグラフに点をプロットして得られる曲線である。ROC曲線の下側の面積をAUC(Area Under the Curve)という。予測確率のランダム性が強いほど、ROC曲線が点(0,0)と(1,1)を繋ぐ線分に近づき、AUCが0.5に近づく。逆に、予測が正しいほど、ROC曲線が点(0,0)と(0,1)を結ぶ線分および点(0,1)と(1,1)を結ぶ線分からなる直角カーブに近づき、AUCが1に近づく。[1]
      したがって、このコンペの提出データは予測結果ではなく、予測確率であるべきだ。また、CatBoostRegressorやRandomForestRegressor, LogisticRegressorなどの回帰モデルの出力値が0から1の間にあり、分類確率と見なしてもよいので、このコンペでは使える。

  2. 作成した組み合わせ特徴量の有効性の確認
      CatBoostRegressorに、作成した各種組み合わせ特徴量を使って、n_estimatorsを変えながら、学習したモデルのtest scoreを調べた。そして、以下の結果が得られた。
      - コンペが提供する基本特徴量のみを使った場合、スコアが0.887前後であった。
      - 基本特徴量について、訓練データと同じものを持つ根源データの口座解除率（以下"1値組み合わせ特徴量"という。n個の基本特徴量の組み合わせに基づいて作成した特徴量を"n値組み合わせ特徴量"という）を追加したとき、スコアが0.888前後に上がった。
      - 2値組み合わせ特徴量をさらに追加したら、スコアが0.8945前後に急上昇した。
      - 3値組み合わせ特徴量をさらに追加したら、スコアが0.8950前後に上がった。
      - 4値組み合わせ特徴量をさらに追加したら、スコアが0.8955前後に上がった。
      したがって、作成した特徴量の組がすべて有効である。また、全特徴量について、埋め込み法(CatBoostRegressor.feature_importances_)を使って重要度を評価した。

  3. 特徴量選択とパラメータ最適化を使った予測
      2で得られた重要度を高い順に並べて、先頭k個の特徴量を選び出して、パラメータを最適化してモデルを学習し、test scoreを調べた。
      CatBoostRegressorのスコアが最高で0.89733に上がった。このスコアはLeaderboard上で307位目(全参加者・チーム数が3633)にあり、約上位8.45%のところにある。つまり、「スコアが上位10%に入る」という目標を達成した。
      
Check
  1. 予測結果として、回帰モデルの予測結果あるいは分類モデルの予測確率を提出すべきだ、ということを確かめた。
  2. 作成した組み合わせ特徴量が有効な予測データであることを確認した。
  3. 特徴量とパラメータ最適化によって、CatBoostRegressorの予測結果のスコアが0.89733に上がり、上位10%に入った。

Action
  1. 今後はモデル評価方法について調べるべきだ。そして、新しいコンペを始めるときに、その評価方法を確認すべきだ。
  2. test scoreが上位10%に入るという目標を達成したため、課題は完成した。

参考文献
  [1] キカガクブログ:「【評価指標】ROC 曲線と AUC についてわかりやすく解説してみた」，キカガク。更新日(2024年4月15日), アクセス日(2024年7月16日)。https://www.kikagaku.co.jp/kikagaku-blog/roc-auc/
