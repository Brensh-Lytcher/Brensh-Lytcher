日付 : 2024/07/08~12
Plan
  1. 新しい特徴量の作成・検証
  2. 高得点コードを調べて、良い解法を調べる

Do
  1. 新しい特徴量の作成・検証
      (1) 訓練データの特定の特徴量組み合わせと同じものを持つ根源データの平均口座解除率
          (前回は訓練データと根源データの共通変数組み合わせを持つものの間の関連性を調べると考えたが、様々な方法を行った結果、根源データの平均口座解除率が一番わかりやすいため、これに決めた。)
          'CreditScore', 'Geography', 'Gender', 'Age', 'Tenure', 'Balance', 'NumOfProducts', 'HasCrCard', 'IsActiveMember', 'EstimatedSalary'の10個の特徴量の任意の1つ、任意の2つからなる組み合わせ、および任意の3つからなる組み合わせのそれぞれと同じ特徴量あるいは組み合わせを持つ根源データの平均口座解除率を新たな特徴量とする。そして、根源データに含まれない特徴量の値あるいは組み合わせを持つ訓練データについて、その新しく生成された特徴量を根源データ全体の平均口座解除率で埋める。
          例えば、trainの特徴量'A'には0, 1, 2の3種類の値があり、originの特徴量'A'には0と1の2種類の値しかない場合、新しく生成される特徴量'a'において、'A'=0のtrainデータに対応するものは、'A'=0を満たすoriginデータの平均口座解除率であり、'A'=1のtrainデータに対応するものは、'A'=1を満たすoriginデータの平均口座解除率であるが、'A'=2のtrainデータに対応するものはoriginデータ全体の平均口座解除率である。
          これらの特徴量の作成において、最大の問題点が計算量である。最初は、trainデータ一つ一つに対して、それと同じ特徴量組み合わせを持つ根源データを見つけ出して、平均口座解除率をtrainの新しいデータ列に入れるようにしていたが、新しい特徴量を1つ作成するのに必要な実行時間が数分もかかった。特徴量1つだけで生成できる特徴量が10個、2つからなる組み合わせで生成できる特徴量が45個、3つからなる組み合わせで生成できる特徴量が120個もあるので、すべての特徴量を生成するためには大変長い時間がかかってしまう。その次に、originのデータの特徴量組み合わせと対応するデータの平均口座解除率の対の辞書型オブジェクトを作成して、pd.DataFrame.map()を使って、trainデータの特徴量組み合わせに対応する値を入れるようにしたが、辞書型オブジェクトの作成に時間がとてもかかった。その後、pd.DataFrame.groupby()を使って高速に辞書型オブジェクトが作成できたが、作成した新しい特徴量をtrainに入れるときに、「PerformanceWarning: DataFrame is highly fragmented.」という警告メッセージが出た。最終的に、pd.concat()を使ってtrainと新しい特徴量を結合することで、この問題を解決できた。
          埋め込み法で、ランダムフォレストモデルによる特徴量重要度の評価を調べたら、新しく作成した特徴量のうち、重要度が高いものがたくさんあることが明らかになった。そして、重要度を高い順に並べると、重要度が0.01以上の特徴量数が約20個あり、0.005以上の特徴量数が約70個あり、0.002以上の特徴量数が約150個ある。(全特徴量の重要度の和が1)。しかし、モデルのパラメータ最適化を行っていなくて、役に立たない特徴量ものぞいていなかったので、検証データの正しく予測できたものの割合が86.7%しかなかった。

      (2) 訓練データと根源データの共通口座番号を持つものの間の関連性を調べる

Check


Action


参考文献

